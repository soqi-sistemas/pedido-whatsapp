let todosProdutos = [];
let carrinho = [];

function carregarProdutos() {
  fetch('https://pedidosw.soqi.com.br/api/produtos.php')
    .then(response => response.json())
    .then(data => {
      todosProdutos = data;
      exibirProdutos(data);
    })
    .catch(error => console.error('Erro ao carregar produtos:', error));
}

function exibirProdutos(produtos) {
  const container = document.getElementById('lista-produtos');
  container.innerHTML = '';

  produtos.forEach(produto => {
    const card = document.createElement('div');
    card.classList.add('produto-card');
    card.innerHTML = `
      <img src="${produto.imagem}" alt="${produto.nome}" />
      <h3>${produto.nome}</h3>
      <p>Pre√ßo: R$ ${produto.preco}</p>
      <p>Sabor: ${produto.sabores ?? '-'}</p>
      <p>Tamanhos: ${produto.tamanhos ?? '-'}</p>
      <button onclick='adicionarAoCarrinho(${JSON.stringify(JSON.stringify(produto))})'>Adicionar</button>
    `;
    container.appendChild(card);
  });
}

function filtrarProdutos(categoria) {
  if (categoria === 'todos') {
    exibirProdutos(todosProdutos);
  } else {
    const filtrados = todosProdutos.filter(p => p.categoria === categoria);
    exibirProdutos(filtrados);
  }
}

function adicionarAoCarrinho(produtoStr) {
  const produto = JSON.parse(produtoStr);
  carrinho.push(produto);
  atualizarCarrinho();
}

function atualizarCarrinho() {
  const lista = document.getElementById('itens-carrinho');
  lista.innerHTML = '';

  carrinho.forEach((item, index) => {
    const li = document.createElement('li');
    li.textContent = `${item.nome} - R$ ${item.preco}`;
    lista.appendChild(li);
  });
}

function finalizarPedido() {
  const mensagem = carrinho.map(p => `${p.nome} - R$${p.preco}`).join("\n");
  const url = `https://wa.me/?text=${encodeURIComponent('Pedido:\n' + mensagem)}`;
  window.open(url, '_blank');
}

carregarProdutos();
